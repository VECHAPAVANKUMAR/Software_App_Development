<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.4.1/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.0/css/all.min.css">
    <title>Home</title>
    <style>

        .input-group-prepend {
            width: 100%;
            font-size: medium;
        }

        .searchform label {
            font-family: Cambria, Cochin, Georgia, Times, 'Times New Roman', serif;
            font-size: large;
            padding-top: 0;
            padding-left: 8px;
        }

        #pop {
            text-align: center;
        }

    </style>

    <script>


        const email = "{{email}}"


        function submit_review(isbn)
        {
            const request = new XMLHttpRequest();
            request.open('POST',"/api/submit_review");
            request.setRequestHeader("Content-Type", "application/json; charset=UTF-8");
            request.onload = () =>{
            var response=JSON.parse(request.responseText);
            if (response.hasOwnProperty("error")){
                    var content = `<p style= "color:red;">${response.error}</p>`
                    document.querySelector('#load').innerHTML += content
            }
            else
            {
                var content = `<p>Email : ${response.email}</p>
                    <p>Rating : ${response.rating} </p>
                    <p>Review : ${response.comment} </p><br><br>`;
                document.querySelector('#load').innerHTML += content
            }


        }
            var value = document.querySelector("#comment").value
            var ele = document.getElementsByName('star');
            // check for the element in the rating that is checked
            var rating = ""
            for(i = 0; i < ele.length; i++) {
                if(ele[i].checked){rating=ele[i].value;}
            }
            var jsonData = JSON.stringify({"isbn":isbn.toString(),"comment" : value,"rating" : rating , "email":email})
            request.send(jsonData);
            return false;


       }

    </script>
</head>
<header>
    <nav class="navbar navbar-expand-md navbar-dark bg-dark sticky-top">
        <a class="navbar-brand" href="/index">Book Reviews</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav ml-auto">
                <li class="nav-item">
                    <a class="nav-link" href="./">Home</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/logout">Logout</a>
                </li>
            </ul>
        </div>
    </nav>
</header>

<body>

    {% with messages = get_flashed_messages() %}
    {% if messages %}
        {% for msg in messages %}

            <div class="alert alert-warning alert-dismissible fade show" role="alert" id="pop">
              <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
              <strong>{{msg}}</strong>
            </div>

            <script>
              $(".alert").alert();
            </script>

        {% endfor %}
    {% endif %}
    {% endwith %}

    <span id="email" value={{email}}></span>
    <div class="container">

        <div class="row" style="margin-top: 5%;" id="search-tab">

            <div class="col-xs-12 col-sm-12 col-md-3 col-lg-3"></div>

            <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6">

                <legend style="text-align: center;">Search Book</legend>

                <p>Search for your favourite book either by it's isbn or title or by author name or by it's published year</p>

                    <div class="input-group mb-3">
                        <div class="input-group-prepend">
                            <input type="search" placeholder="" name="search_item" class="form-control" id="search_item"
                                aria-label="search_item" aria-describedby="basic-addon1" required>
                            <span class="input-group-text" id="basic-addon1"><i class="fa fa-search" aria-hidden="true"></i></span>
                        </div>
                    </div>

                    <div>
                        <button type="submit" class="btn btn-primary" style="width: 150px;" onclick="search()">Search</button>
                    </div>
                    <p id="load" style="text-align: center;"></p>
                </div>
            <div class="col-xs-12 col-sm-12 col-md-3 col-lg-3"></div>
        </div>

        <div class="row" id="books">
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.slim.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.4.1/js/bootstrap.min.js"></script>
</body>

</html>

